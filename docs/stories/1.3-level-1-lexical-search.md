# Story 1.3: Level 1 - Lexical Search

**Status**: Draft

## Story

As a user, I want the system to be able to use a simple keyword-based search for retrieval, so that I have a baseline RAG implementation.

## Acceptance Criteria

1.  The system can use a full-text search index for retrieval instead of vector search.
2.  This pipeline can be selected via the RAG pipeline level selector in the `SettingsView`.
3.  The evaluation framework can measure and display metrics for this level (e.g., Hit Rate, MRR).
4.  The existing vector search functionality is not affected and remains the default.
5.  The lexical search respects the document selection from Story 1.2.

## Dev Notes

*   **Database - SurrealDB Full-Text Search**: SurrealDB has built-in full-text search. We will need to:
    *   Define a search index on the `content` field of the `embeddings` table.
    *   Use the `@@` (MATCHES) operator for querying.
    *   [Source: https://surrealdb.com/docs/surrealql/functions/search]
*   **RAG Pipeline Selection**: The `SettingsView` already has a selector for the RAG pipeline level. A new option for "Level 1 - Lexical Search" should be added.
*   **ChatService Logic**: The `_rag` method in `ChatService` will need a conditional block. Based on the selected pipeline level from `SettingService`, it will either call the existing `_retrieve` (vector search) method or a new `_lexical_retrieve` method.
*   **Repository Layer**: A new method, `lexicalSearch`, needs to be added to the `EmbeddingRepository`. This method will execute the full-text search query against the database.

### Testing
*   **Test file location**: All new tests should be placed in the `test/` directory of their respective packages.
*   **Test standards**: Follow existing testing patterns and conventions.
*   **Frameworks**: Use the existing `flutter_test` and `mockito` frameworks.
*   **Requirements**: Unit tests must be written for the new `lexicalSearch` repository method and the updated `ChatService` logic.

## Tasks / Subtasks

1.  **Database (SurrealDB)**
    *   [ ] (AC: 1) Define a full-text search index on the `content` field of the `embeddings` table. This should be added to the database schema creation logic.
2.  **Repository (`EmbeddingRepository`)**
    *   [ ] (AC: 1) Implement a new `lexicalSearch` method that takes a query string and a list of document IDs.
    *   [ ] (AC: 1) The method should use the `@@` operator to perform a full-text search on the `content` field of the embeddings, filtered by the selected document IDs.
3.  **Settings (`SettingsView` and `SettingService`)**
    *   [ ] (AC: 2) Add "Level 1 - Lexical Search" as an option to the RAG pipeline level selector in the UI.
    *   [ ] (AC: 2) Update the `SettingService` to store and retrieve this new pipeline level.
4.  **Chat Service (`ChatService`)**
    *   [ ] (AC: 1, 4, 5) In the `_rag` method, add a switch or if/else block based on the RAG pipeline level from `SettingService`.
    *   [ ] (AC: 1, 5) If the level is "Lexical Search", call the new `EmbeddingRepository.lexicalSearch` method.
    *   [ ] (AC: 4) Ensure the default case still calls the existing vector search (`_retrieve`) method.
5.  **Testing**
    *   [ ] (AC: 1) Write a unit test for the `EmbeddingRepository.lexicalSearch` method.
    *   [ ] (AC: 1, 2, 4, 5) Write unit tests for the `ChatService._rag` method to verify that the correct retrieval method is called based on the selected pipeline level.
